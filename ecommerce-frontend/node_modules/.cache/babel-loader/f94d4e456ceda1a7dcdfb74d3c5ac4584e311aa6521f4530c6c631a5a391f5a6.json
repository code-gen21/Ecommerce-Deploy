{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/kandw/Desktop/Ecommerce/ecommerce-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/kandw/Desktop/Ecommerce/ecommerce-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/kandw/Desktop/Ecommerce/ecommerce-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import React,{useState}from'react';import{useSelector}from'react-redux';import{useNavigate}from'react-router-dom';import{useCreateOrderMutation}from'../services/appApi';import{Row,Col,Alert,Form,Button,Card}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function CheckoutForm(){var stripe=useStripe();var elements=useElements();var user=useSelector(function(state){return state.user;});var navigate=useNavigate();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),alertMessage=_useState2[0],setAlertMessage=_useState2[1];var _useCreateOrderMutati=useCreateOrderMutation(),_useCreateOrderMutati2=_slicedToArray(_useCreateOrderMutati,2),createOrder=_useCreateOrderMutati2[0],_useCreateOrderMutati3=_useCreateOrderMutati2[1],isLoading=_useCreateOrderMutati3.isLoading,isError=_useCreateOrderMutati3.isError,isSuccess=_useCreateOrderMutati3.isSuccess;var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),country=_useState4[0],setCountry=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),address=_useState6[0],setAddress=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),paying=_useState8[0],setPaying=_useState8[1];function handlePay(_x){return _handlePay.apply(this,arguments);}function _handlePay(){_handlePay=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _yield$fetch$then,client_secret,_yield$stripe$confirm,paymentIntent,error;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements||user.cart.count==0)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setPaying(true);_context.next=6;return fetch('http://localhost:8080/create-payment',{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({amount:user.cart.total})}).then(function(res){return res.json();});case 6:_yield$fetch$then=_context.sent;client_secret=_yield$fetch$then.client_secret;_context.next=10;return stripe.confirmCardPayment(client_secret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(result){// Handle result.error or result.paymentIntent\n// console.log(result);\nreturn result;});case 10:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;error=_yield$stripe$confirm.error;setPaying(false);console.log(error);if(error){setAlertMessage(\"Payment failed: \".concat(error.message));}if(paymentIntent){createOrder({userId:user._id,cart:user.cart,address:address,country:country}).then(function(res){if(!isLoading&&!isError){if(paymentIntent.status==='succeeded'){setAlertMessage(\"Payment \".concat(paymentIntent.status));}setTimeout(function(){navigate('/orders');},2000);}});}case 17:case\"end\":return _context.stop();}},_callee);}));return _handlePay.apply(this,arguments);}return/*#__PURE__*/_jsx(Col,{className:\"cart-payment-container\",children:/*#__PURE__*/_jsxs(Form,{onSubmit:handlePay,children:[/*#__PURE__*/_jsxs(Row,{children:[alertMessage&&/*#__PURE__*/_jsx(Alert,{children:alertMessage}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"First Name\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"First Name\",value:user.name,disabled:true})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"email\",placeholder:\"Email\",value:user.email,disabled:true})]})})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Address\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Address\",value:address,onChange:function onChange(e){return setAddress(e.target.value);}})]})}),/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Country\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Country\",value:country,onChange:function onChange(e){return setCountry(e.target.value);}})]})})]}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"card-element\",children:\"Card\"}),/*#__PURE__*/_jsx(CardElement,{id:\"card-element\"}),/*#__PURE__*/_jsx(Button,{className:\"mt-3\",type:\"submit\",disabled:user.cart.count<=0||paying||isSuccess,children:paying?\"Processing...\":\"Pay\"})]})});}export default CheckoutForm;","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useState","useSelector","useNavigate","useCreateOrderMutation","Row","Col","Alert","Form","Button","Card","jsx","_jsx","jsxs","_jsxs","CheckoutForm","stripe","elements","user","state","navigate","_useState","_useState2","_slicedToArray","alertMessage","setAlertMessage","_useCreateOrderMutati","_useCreateOrderMutati2","createOrder","_useCreateOrderMutati3","isLoading","isError","isSuccess","_useState3","_useState4","country","setCountry","_useState5","_useState6","address","setAddress","_useState7","_useState8","paying","setPaying","handlePay","_x","_handlePay","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","_yield$fetch$then","client_secret","_yield$stripe$confirm","paymentIntent","error","wrap","_callee$","_context","prev","next","preventDefault","cart","count","abrupt","fetch","method","headers","body","JSON","stringify","amount","total","then","res","json","sent","confirmCardPayment","payment_method","card","getElement","result","console","log","concat","message","userId","_id","status","setTimeout","stop","className","children","onSubmit","md","Group","Label","Control","type","placeholder","value","name","disabled","email","onChange","target","htmlFor","id"],"sources":["C:/Users/kandw/Desktop/Ecommerce/ecommerce-frontend/src/components/CheckoutForm.js"],"sourcesContent":["import { CardElement, useElements, useStripe } from '@stripe/react-stripe-js'\r\nimport React,{useState} from 'react'\r\nimport { useSelector } from 'react-redux';\r\nimport {useNavigate} from 'react-router-dom';\r\nimport { useCreateOrderMutation } from '../services/appApi';\r\nimport { Row,Col,Alert,Form,Button, Card } from 'react-bootstrap';\r\n\r\nfunction CheckoutForm() {\r\n    const stripe=useStripe();\r\n    const elements=useElements();\r\n    const user=useSelector(state=>state.user);\r\n    const navigate=useNavigate();\r\n    const [alertMessage,setAlertMessage]=useState(\"\");\r\n    const [createOrder,{isLoading,isError,isSuccess}]=useCreateOrderMutation();\r\n    const [country,setCountry]=useState('');\r\n    const [address,setAddress]=useState(\"\");\r\n    const [paying,setPaying]=useState(false);\r\n\r\n\r\n\r\n    async function handlePay(e){\r\n        e.preventDefault();\r\n        if(!stripe || !elements || user.cart.count==0)\r\n        return;\r\n        setPaying(true);\r\n\r\n        const {client_secret}=await fetch('http://localhost:8080/create-payment',{\r\n            method:\"POST\",\r\n            headers:{\r\n                \"Content-Type\":\"application/json\",\r\n            },\r\n            body:JSON.stringify({amount:user.cart.total}),\r\n        }).then((res)=>res.json());\r\n        \r\n        // const k=elements.getElement(CardElement);\r\n        // console.log(k);\r\n\r\n\r\n        const {paymentIntent,error}=await stripe.confirmCardPayment(client_secret,{\r\n            payment_method:{\r\n                card:elements.getElement(CardElement),\r\n            },\r\n        }).then(function(result) {\r\n    // Handle result.error or result.paymentIntent\r\n    // console.log(result);\r\n        \r\n    return result;\r\n  });\r\n        \r\n        \r\n        setPaying(false);\r\n        console.log(error);\r\n        if(error){\r\n            setAlertMessage(`Payment failed: ${error.message}`);\r\n        }\r\n        if(paymentIntent){\r\n            \r\n            createOrder({userId:user._id,cart:user.cart,address,country}).then(res=>{\r\n                if(!isLoading && !isError){\r\n                    if(paymentIntent.status==='succeeded'){\r\n                        setAlertMessage(`Payment ${paymentIntent.status}`);\r\n                    }\r\n                    setTimeout(()=>{\r\n                        navigate('/orders')\r\n                    },2000);\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n  return <Col className=\"cart-payment-container\">\r\n    <Form onSubmit={handlePay}>\r\n        <Row>\r\n            {alertMessage && <Alert>{alertMessage}</Alert>}\r\n       \r\n        <Col md={6}>\r\n            <Form.Group className=\"mb-3\">\r\n                <Form.Label>First Name</Form.Label>\r\n                <Form.Control type=\"text\" placeholder=\"First Name\" value={user.name} disabled />\r\n            </Form.Group>\r\n        </Col>\r\n        <Col md={6}>\r\n            <Form.Group className=\"mb-3\">\r\n                <Form.Label>Email</Form.Label>\r\n                <Form.Control type=\"email\" placeholder=\"Email\" value={user.email} disabled />\r\n            </Form.Group>\r\n        </Col>\r\n         </Row>\r\n         <Row>\r\n             <Col md={6}>\r\n                <Form.Group className=\"mb-3\">\r\n                    <Form.Label>Address</Form.Label>\r\n                    <Form.Control type=\"text\" placeholder=\"Address\" value={address} onChange={(e)=>setAddress(e.target.value)} />\r\n                </Form.Group>\r\n             </Col>\r\n             <Col md={6}>\r\n                <Form.Group className=\"mb-3\">\r\n                    <Form.Label>Country</Form.Label>\r\n                    <Form.Control type=\"text\" placeholder=\"Country\" value={country} onChange={(e)=>setCountry(e.target.value)} />\r\n                </Form.Group>\r\n             </Col>\r\n         </Row>\r\n         <label htmlFor=\"card-element\">Card</label>\r\n         <CardElement id=\"card-element\" />\r\n         <Button className=\"mt-3\" type=\"submit\" disabled={user.cart.count<=0 || paying || isSuccess}>{paying?\"Processing...\":\"Pay\"}</Button>\r\n    </Form>\r\n  </Col>\r\n}\r\n\r\nexport default CheckoutForm"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}